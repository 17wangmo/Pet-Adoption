"use strict";(()=>{var e={};e.id=230,e.ids=[230],e.modules={11185:e=>{e.exports=require("mongoose")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},55037:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>y,patchFetch:()=>x,requestAsyncStorage:()=>g,routeModule:()=>c,serverHooks:()=>w,staticGenerationAsyncStorage:()=>h});var a={};t.r(a),t.d(a,{GET:()=>m});var s=t(49303),i=t(88716),n=t(60670),o=t(87070),l=t(16385),p=t(76837),u=t(75571),d=t(4879);async function m(e){try{let e=await (0,u.getServerSession)(d.authOptions);if(!e||"admin"!==e.user.role)return o.NextResponse.json({error:"Unauthorized"},{status:401});await (0,l.Z)();let r=await p.Z.find().sort({name:1});return o.NextResponse.json(r)}catch(e){return o.NextResponse.json({error:"Error fetching animals"},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/animals/route",pathname:"/api/admin/animals",filename:"route",bundlePath:"app/api/admin/animals/route"},resolvedPagePath:"C:\\Users\\tsher\\OneDrive\\Desktop\\CTE204\\pet adoption - Copy\\src\\app\\api\\admin\\animals\\route.js",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:w}=c,y="/api/admin/animals/route";function x(){return(0,n.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:h})}},4879:(e,r,t)=>{t.r(r),t.d(r,{GET:()=>u,POST:()=>u,authOptions:()=>p});var a=t(75571),s=t.n(a),i=t(53797),n=t(98691),o=t(16385),l=t(6590);let p={providers:[(0,i.Z)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){try{await (0,o.Z)();let r=await l.Z.findOne({email:e.email});if(!r)throw Error("No user found with this email");if(!await n.ZP.compare(e.password,r.password))throw Error("Invalid password");return{id:r._id.toString(),name:r.name,email:r.email,role:r.role}}catch(e){throw Error(e.message)}}})],callbacks:{jwt:async({token:e,user:r,account:t})=>(r&&(e.id=r.id,e.role=r.role),e),session:async({session:e,token:r})=>(e.user&&(e.user.id=r.id,e.user.role=r.role),e)},pages:{signIn:"/auth/login",error:"/auth/error"},session:{strategy:"jwt",maxAge:86400},secret:process.env.NEXTAUTH_SECRET||"your-secret-key"},u=s()(p)},16385:(e,r,t)=>{t.d(r,{Z:()=>o});var a=t(11185),s=t.n(a);let i=process.env.MONGODB_URI;if(!i)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let n=global.mongoose;n||(n=global.mongoose={conn:null,promise:null});let o=async function(){if(n.conn)return n.conn;n.promise||(n.promise=s().connect(i,{bufferCommands:!1}).then(e=>e));try{n.conn=await n.promise}catch(e){throw n.promise=null,e}return n.conn}},76837:(e,r,t)=>{t.d(r,{Z:()=>n});var a=t(11185),s=t.n(a);let i=new(s()).Schema({name:{type:String,required:!0,trim:!0},breed:{type:String,required:!0,trim:!0},age:{type:String,required:!0},image:{type:String,required:!0},species:{type:String,required:!0,enum:["dog","cat","bird","guinea-pig","rabbit"]}},{collection:"Animal"}),n=s().models.Animal||s().model("Animal",i)},6590:(e,r,t)=>{t.d(r,{Z:()=>o});var a=t(11185),s=t.n(a),i=t(98691);let n=new(s()).Schema({name:{type:String,required:[!0,"Please provide your name"],trim:!0},email:{type:String,required:[!0,"Please provide your email"],unique:!0,trim:!0,lowercase:!0,match:[/^\S+@\S+\.\S+$/,"Please provide a valid email"]},password:{type:String,required:[!0,"Please provide a password"],minlength:[6,"Password must be at least 6 characters long"]},role:{type:String,enum:["user","admin"],default:"user"},phone:{type:String,required:!1},createdAt:{type:Date,default:Date.now}});n.pre("save",async function(e){if(!this.isModified("password"))return e();try{let r=await i.ZP.genSalt(10);this.password=await i.ZP.hash(this.password,r),e()}catch(r){e(r)}}),n.methods.comparePassword=async function(e){return i.ZP.compare(e,this.password)},n.set("toJSON",{transform:function(e,r){return delete r.password,r}});let o=s().models.User||s().model("User",n)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[276,972,691,790],()=>t(55037));module.exports=a})();