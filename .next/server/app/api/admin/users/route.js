"use strict";(()=>{var e={};e.id=628,e.ids=[628],e.modules={11185:e=>{e.exports=require("mongoose")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},27759:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>x,patchFetch:()=>y,requestAsyncStorage:()=>h,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>w});var s={};t.r(s),t.d(s,{GET:()=>c});var a=t(49303),o=t(88716),n=t(60670),i=t(87070),u=t(16385),p=t(6590),l=t(75571),d=t(4879);async function c(e){try{let e=await (0,l.getServerSession)(d.authOptions);if(!e||"admin"!==e.user.role)return i.NextResponse.json({error:"Unauthorized"},{status:401});await (0,u.Z)();let r=await p.Z.find({},"-password").sort({createdAt:-1});return i.NextResponse.json(r)}catch(e){return i.NextResponse.json({error:"Error fetching users"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/users/route",pathname:"/api/admin/users",filename:"route",bundlePath:"app/api/admin/users/route"},resolvedPagePath:"C:\\Users\\tsher\\OneDrive\\Desktop\\CTE204\\pet adoption - Copy\\src\\app\\api\\admin\\users\\route.js",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:w,serverHooks:g}=m,x="/api/admin/users/route";function y(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:w})}},4879:(e,r,t)=>{t.r(r),t.d(r,{GET:()=>l,POST:()=>l,authOptions:()=>p});var s=t(75571),a=t.n(s),o=t(53797),n=t(98691),i=t(16385),u=t(6590);let p={providers:[(0,o.Z)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){try{await (0,i.Z)();let r=await u.Z.findOne({email:e.email});if(!r)throw Error("No user found with this email");if(!await n.ZP.compare(e.password,r.password))throw Error("Invalid password");return{id:r._id.toString(),name:r.name,email:r.email,role:r.role}}catch(e){throw Error(e.message)}}})],callbacks:{jwt:async({token:e,user:r,account:t})=>(r&&(e.id=r.id,e.role=r.role),e),session:async({session:e,token:r})=>(e.user&&(e.user.id=r.id,e.user.role=r.role),e)},pages:{signIn:"/auth/login",error:"/auth/error"},session:{strategy:"jwt",maxAge:86400},secret:process.env.NEXTAUTH_SECRET||"your-secret-key"},l=a()(p)},16385:(e,r,t)=>{t.d(r,{Z:()=>i});var s=t(11185),a=t.n(s);let o=process.env.MONGODB_URI;if(!o)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let n=global.mongoose;n||(n=global.mongoose={conn:null,promise:null});let i=async function(){if(n.conn)return n.conn;n.promise||(n.promise=a().connect(o,{bufferCommands:!1}).then(e=>e));try{n.conn=await n.promise}catch(e){throw n.promise=null,e}return n.conn}},6590:(e,r,t)=>{t.d(r,{Z:()=>i});var s=t(11185),a=t.n(s),o=t(98691);let n=new(a()).Schema({name:{type:String,required:[!0,"Please provide your name"],trim:!0},email:{type:String,required:[!0,"Please provide your email"],unique:!0,trim:!0,lowercase:!0,match:[/^\S+@\S+\.\S+$/,"Please provide a valid email"]},password:{type:String,required:[!0,"Please provide a password"],minlength:[6,"Password must be at least 6 characters long"]},role:{type:String,enum:["user","admin"],default:"user"},phone:{type:String,required:!1},createdAt:{type:Date,default:Date.now}});n.pre("save",async function(e){if(!this.isModified("password"))return e();try{let r=await o.ZP.genSalt(10);this.password=await o.ZP.hash(this.password,r),e()}catch(r){e(r)}}),n.methods.comparePassword=async function(e){return o.ZP.compare(e,this.password)},n.set("toJSON",{transform:function(e,r){return delete r.password,r}});let i=a().models.User||a().model("User",n)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,972,691,790],()=>t(27759));module.exports=s})();